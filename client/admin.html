<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal Bridge - כניסה לעורכי דין</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
    
    <style>
        .admin-login-section {
            background: var(--gradient-dark);
            color: var(--text-light);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .admin-login-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(74, 108, 247, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(244, 196, 48, 0.1) 0%, transparent 50%);
        }

        .admin-login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 50px;
            width: 100%;
            max-width: 450px;
            text-align: center;
            box-shadow: var(--shadow-strong);
            position: relative;
            z-index: 2;
            border: 1px solid rgba(74, 108, 247, 0.2);
        }

        .admin-login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-gold));
            border-radius: 20px 20px 0 0;
        }

        .admin-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 30px;
            background: linear-gradient(45deg, var(--accent-blue), var(--accent-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .admin-subtitle {
            color: var(--text-muted);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .back-to-site {
            position: absolute;
            top: 20px;
            right: 20px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-size: 0.9rem;
            transition: var(--transition);
            z-index: 3;
        }

        .back-to-site:hover {
            color: var(--accent-gold);
        }

        .lawyer-info {
            background: rgba(74, 108, 247, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 25px;
            border-right: 4px solid var(--accent-blue);
        }
    </style>
</head>
<body>

    <a href="/" class="back-to-site">
        <i class="fas fa-arrow-right me-1"></i>
        חזרה לאתר הראשי
    </a>

    <section class="admin-login-section">
        <div class="admin-login-card">
            <h1 class="admin-title">
                <i class="fas fa-user-tie me-2"></i>
                כניסה לעורכי דין
            </h1>
            
            <div class="lawyer-info">
                <strong>פאנל ניהול לעורכי דין</strong><br>
                <small>כניסה מאובטחת למערכת ניהול התיקים</small>
            </div>

            <p class="admin-subtitle">
                הזן את פרטי ההתחברות שלך לגישה למערכת
            </p>

            <form id="admin-login-form">
                <div class="form-group mb-3">
                    <input type="text" id="admin-username" class="form-control" placeholder="שם משתמש" required>
                </div>
                
                <div class="form-group mb-3">
                    <input type="password" id="admin-password" class="form-control" placeholder="סיסמה" required>
                </div>
                
                <div class="text-end mb-3">
                    <a href="#" id="admin-forgot-password" class="forgot-password-link">שכחתי סיסמה</a>
                </div>
                
                <button type="submit" class="btn-submit">
                    <i class="fas fa-sign-in-alt me-2"></i>
                    כניסה לפאנל ניהול
                </button>
            </form>
        </div>
    </section>

    <!-- מודל שכחתי סיסמה -->
    <div class="modal-overlay" id="admin-forgot-modal" style="display: none;">
        <div class="modal-content">
            <span class="close-btn" id="admin-forgot-close">&times;</span>
            <h2 class="modal-title">איפוס סיסמה</h2>
            
            <form id="admin-forgot-form">
                <div class="form-group">
                    <input type="text" id="admin-forgot-username" class="form-control" placeholder="שם משתמש" required>
                </div>
                
                <div class="form-group">
                    <input type="email" id="admin-forgot-email" class="form-control" placeholder="כתובת אימייל" required>
                </div>
                
                <button type="submit" class="btn-submit" style="background: linear-gradient(135deg, var(--accent-gold), #f6d55c);">
                    <i class="fas fa-envelope me-2"></i>
                    שלח קישור לאיפוס
                </button>
            </form>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const adminForm = document.getElementById('admin-login-form');
            const adminForgotLink = document.getElementById('admin-forgot-password');
            const adminForgotModal = document.getElementById('admin-forgot-modal');
            const adminForgotClose = document.getElementById('admin-forgot-close');
            const adminForgotForm = document.getElementById('admin-forgot-form');

            // טיפול בהתחברות אדמין
            adminForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const username = document.getElementById('admin-username').value.trim();
                const password = document.getElementById('admin-password').value.trim();
                
                const submitBtn = adminForm.querySelector('.btn-submit');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>מתחבר...';
                submitBtn.disabled = true;

                try {
                    const response = await fetch('http://localhost:5000/api/auth/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ username, password }),
                    });

                    const data = await response.json();

                    if (response.ok) {
                        // בדיקה שזה באמת עורכת דין
                        if (data.role === 'lawyer') {
                            showSuccessMessage('התחברת בהצלחה!');
                            localStorage.setItem('username', data.username);
                            localStorage.setItem('role', data.role);
                            localStorage.setItem('token', data.token);
                            
                            setTimeout(() => {
                                window.location.href = 'pages/lawyer-home.html';
                            }, 1500);
                        } else {
                            showErrorMessage('הגישה מותרת רק לעורכי דין רשומים במערכת');
                        }
                    } else {
                        showErrorMessage(data.message || 'שגיאה בהתחברות');
                    }
                } catch (error) {
                    console.error('שגיאה בהתחברות אדמין:', error);
                    showErrorMessage('שגיאה בחיבור לשרת');
                } finally {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            });

            // שכחתי סיסמה
            adminForgotLink.addEventListener('click', (e) => {
                e.preventDefault();
                adminForgotModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            });

            adminForgotClose.addEventListener('click', () => {
                adminForgotModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });

            window.addEventListener('click', (e) => {
                if (e.target === adminForgotModal) {
                    adminForgotModal.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });

            adminForgotForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const username = document.getElementById('admin-forgot-username').value.trim();
                const email = document.getElementById('admin-forgot-email').value.trim();
                
                const submitBtn = adminForgotForm.querySelector('.btn-submit');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>שולח...';
                submitBtn.disabled = true;

                try {
                    const response = await fetch('http://localhost:5000/api/auth/forgot-password', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, email }),
                    });

                    const data = await response.json();
                    
                    if (response.ok) {
                        showSuccessMessage(data.message);
                        setTimeout(() => {
                            adminForgotModal.style.display = 'none';
                            document.body.style.overflow = 'auto';
                            adminForgotForm.reset();
                        }, 1500);
                    } else {
                        showErrorMessage(data.message);
                    }
                } catch (error) {
                    console.error('שגיאה באיפוס סיסמה:', error);
                    showErrorMessage('שגיאה בחיבור לשרת');
                } finally {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            });

            // פונקציות הודעות
            function showSuccessMessage(message) {
                showNotification(message, 'success');
            }

            function showErrorMessage(message) {
                showNotification(message, 'error');
            }

            function showNotification(message, type) {
                const existingNotifications = document.querySelectorAll('.notification');
                existingNotifications.forEach(notification => notification.remove());

                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} me-2"></i>
                    ${message}
                `;

                Object.assign(notification.style, {
                    position: 'fixed',
                    top: '20px',
                    right: '20px',
                    padding: '15px 20px',
                    borderRadius: '10px',
                    color: 'white',
                    fontWeight: '500',
                    zIndex: '3000',
                    minWidth: '300px',
                    textAlign: 'right',
                    boxShadow: '0 10px 25px -5px rgba(0, 0, 0, 0.2)',
                    background: type === 'success' ? 
                        'linear-gradient(135deg, #10b981, #059669)' : 
                        'linear-gradient(135deg, #ef4444, #dc2626)',
                    animation: 'slideInRight 0.3s ease-out'
                });

                if (!document.querySelector('#notification-styles')) {
                    const style = document.createElement('style');
                    style.id = 'notification-styles';
                    style.textContent = `
                        @keyframes slideInRight {
                            from { transform: translateX(100%); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                        @keyframes slideOutRight {
                            from { transform: translateX(0); opacity: 1; }
                            to { transform: translateX(100%); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.animation = 'slideOutRight 0.3s ease-in';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }, 4000);
            }
        });
    </script>
</body>
</html>