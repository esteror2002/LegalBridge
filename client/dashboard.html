<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <title>×“×©×‘×•×¨×“ ×¢×•×¨×›×ª ×“×™×Ÿ | Legal Bridge</title>
    <link rel="stylesheet" href="lawyer-home.css">
    <link rel="stylesheet" href="dashboard.css">
</head>
<body>
  <div class="layout-container">

    <!-- ×¡×¨×’×œ ×¦×“ -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2 id="greeting">×©×œ×•×, ×¢×•×¨×›×ª ×“×™×Ÿ</h2>
        <button onclick="logout()">ğŸšª ×”×ª× ×ª×§×•×ª</button>
      </div>
      <nav class="lawyer-options">
        <ul>
          <li><a href="lawyer-profile.html">ğŸ‘¤ ××–×•×¨ ××™×©×™</a></li>
          <li><a href="dashboard.html">ğŸ§¾ ×œ×§×•×—×•×ª ×××ª×™× ×™× ×œ××™×©×•×¨</a></li>
          <li><a href="clients-list.html">ğŸ‘¥ ×¦×¤×™×™×” ×‘×œ×§×•×—×•×ª</a></li>
          <li><a href="lawyer-requests.html">ğŸ“¬ ×¤× ×™×•×ª ×œ×§×•×—×•×ª</a></li>
        </ul>
      </nav>
    </aside>

    <!-- ×ª×•×›×Ÿ ×¢×™×§×¨×™ -->
    <main class="main-content">
      <h1>×œ×§×•×—×•×ª ×××ª×™× ×™× ×œ××™×©×•×¨</h1>

      <table id="users-table">
          <thead>
              <tr>
                  <th>×©× ××©×ª××©</th>
                  <th>××™××™×™×œ</th>
                  <th>×˜×œ×¤×•×Ÿ</th>
                  <th>×›×ª×•×‘×ª</th>
                  <th>×ª×¤×§×™×“</th>
                  <th>××™×©×•×¨</th>
                  <th>××—×™×§×”</th>
              </tr>
          </thead>
          <tbody></tbody>
      </table>
    </main>
  </div>

  <script>
    const username = localStorage.getItem('username');
    const role = localStorage.getItem('role');

    if (!username || role !== 'lawyer') {
        alert('×”×›× ×™×¡×” ××•×ª×¨×ª ×¨×§ ×œ×¢×•×¨×›×•×ª ×“×™×Ÿ');
        window.location.href = 'index.html';
    } else {
        document.getElementById('greeting').innerText = `×©×œ×•×, ${username}`;
    }

    async function fetchPendingUsers() {
        try {
            const response = await fetch('http://localhost:5000/api/auth/pending-users');
            const users = await response.json();
            const tbody = document.querySelector('#users-table tbody');
            tbody.innerHTML = '';

            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td>${user.phone || '-'}</td>
                    <td>${user.address || '-'}</td>
                    <td>${user.role}</td>
                    <td><button class="approve" onclick="approveUser('${user._id}')">âœ”ï¸ ××©×¨</button></td>
                    <td><button class="delete" onclick="deleteUser('${user._id}')">ğŸ—‘ï¸ ××—×§</button></td>
                `;
                tbody.appendChild(row);
            });
        } catch (error) {
            console.error('×©×’×™××” ×‘×©×œ×™×¤×ª ××©×ª××©×™× ×××ª×™× ×™×:', error);
        }
    }

    async function approveUser(id) {
        await fetch(`http://localhost:5000/api/auth/approve-user/${id}`, {
            method: 'POST'
        });
        fetchPendingUsers();
    }

    async function deleteUser(id) {
        await fetch(`http://localhost:5000/api/auth/delete-user/${id}`, {
            method: 'DELETE'
        });
        fetchPendingUsers();
    }

    function logout() {
        localStorage.clear();
        window.location.href = 'index.html';
    }

    fetchPendingUsers();
  </script>
</body>
</html>
